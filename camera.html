<div style="margin-top: 20px;">
    <button id="takePictureBtn">Take Picture</button>
</div>

<div style="margin-top: 20px; display: flex; justify-content: center; align-items: center;">
    <!-- Video feed for camera preview -->
    <video id="cameraPreview" autoplay playsinline style="width: 200px; height: 150px; border: 1px solid #000;"></video>

    <!-- Canvas for captured image -->
    <canvas id="pictureCanvas" style="display: none;"></canvas>
</div>

<script>
    let video = document.getElementById('cameraPreview');
    let canvas = document.getElementById('pictureCanvas');
    let context = canvas.getContext('2d');

    // Start the camera on page load
    function startCamera() {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(function(stream) {
            video.srcObject = stream;
        })
        .catch(function(err) {
            console.error("Error accessing camera: " + err);
            alert("Unable to access camera. Please ensure you have granted camera permissions.");
        });
    }

    // Function to capture and download picture
    function takePicture() {
        // Set canvas dimensions to match video
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // Draw the current video frame onto the canvas
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Create a unique filename using the current timestamp
        let timestamp = Date.now();
        let imgData = canvas.toDataURL('image/png');
        let downloadLink = document.createElement('a');
        downloadLink.href = imgData;
        downloadLink.download = `captured-image-${timestamp}.png`;

        // Trigger the download
        downloadLink.click();
    }

    // Event listener for the "Take Picture" button
    document.getElementById('takePictureBtn').onclick = function() {
        takePicture();
    };

    // Start the camera preview on page load
    window.onload = startCamera;
</script>
