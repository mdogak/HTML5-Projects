<div style="margin-top: 20px;">
    <button id="startStopBtn" onclick="toggleStopwatch()">Start</button>
    <button onclick="clearStopwatch()">Clear</button>
</div>

<!-- Take Picture Section -->
<div style="margin-top: 20px;">
    <button id="takePictureBtn">Take Picture</button>
</div>

<div style="margin-top: 20px; display: flex; justify-content: center; align-items: center;">
    <!-- Video feed for camera preview -->
    <video id="cameraPreview" autoplay playsinline style="width: 200px; height: 150px; border: 1px solid #000;"></video>

    <!-- Canvas for captured image preview -->
    <canvas id="pictureCanvas" style="display: none;"></canvas>
</div>

<script>
    let video = document.getElementById('cameraPreview');
    let canvas = document.getElementById('pictureCanvas');
    let context = canvas.getContext('2d');

    // Start camera when the "Take Picture" button is clicked
    document.getElementById('takePictureBtn').onclick = function() {
        // Check if camera access is allowed
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(function(stream) {
            // Display the video feed in the video element
            video.srcObject = stream;
        })
        .catch(function(err) {
            console.error("Error accessing camera: " + err);
            alert("Unable to access camera. Please ensure you have granted camera permissions.");
        });
    };

    // Capture still image from video feed
    video.onclick = function() {
        // Set canvas dimensions to match video
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // Draw current video frame onto the canvas
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Stop the video stream after the picture is taken
        let stream = video.srcObject;
        let tracks = stream.getTracks();
        tracks.forEach(track => track.stop());

        // Display the captured image
        let img = canvas.toDataURL('image/png');
        let picturePreview = new Image();
        picturePreview.src = img;
        picturePreview.style.width = '200px';
        picturePreview.style.height = '150px';

        // Replace the video feed with the captured image
        video.replaceWith(picturePreview);
    };
</script>
