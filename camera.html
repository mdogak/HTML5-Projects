<div style="margin-top: 20px;">
    <button id="takePictureBtn">Take Picture</button>
</div>

<div style="margin-top: 20px; display: flex; justify-content: center; align-items: center;">
    <!-- Video feed for camera preview -->
    <video id="cameraPreview" autoplay playsinline style="width: 200px; height: 150px; border: 1px solid #000;"></video>

    <!-- Canvas for captured image -->
    <canvas id="pictureCanvas" style="display: none;"></canvas>
</div>

<script>
    let video = document.getElementById('cameraPreview');
    let canvas = document.getElementById('pictureCanvas');
    let context = canvas.getContext('2d');

    // Start camera and take picture when the "Take Picture" button is clicked
    document.getElementById('takePictureBtn').onclick = function() {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(function(stream) {
            video.srcObject = stream;

            // Take picture after 1 second to ensure video feed is active
            setTimeout(() => {
                // Set canvas dimensions to match video
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;

                // Draw the current video frame onto the canvas
                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                // Stop the video stream
                let tracks = stream.getTracks();
                tracks.forEach(track => track.stop());

                // Automatically download the captured image
                let imgData = canvas.toDataURL('image/png');
                let downloadLink = document.createElement('a');
                downloadLink.href = imgData;
                downloadLink.download = 'captured-image.png';
                downloadLink.click();  // Trigger the download

            }, 1000); // Delay to allow camera feed to initialize properly
        })
        .catch(function(err) {
            console.error("Error accessing camera: " + err);
            alert("Unable to access camera. Please ensure you have granted camera permissions.");
        });
    };
</script>
