
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Photos Upload with Timer</title>
    <!-- Load Google Platform Library -->
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <!-- Google Sign-In Meta -->
    <meta name="google-signin-client_id" content="YOUR_CLIENT_ID.apps.googleusercontent.com">
</head>
<body>
    <!-- Google Sign-In Button -->
    <div class="g-signin2" data-onsuccess="onSignIn"></div>
    <br>
    
    <!-- Camera Input -->
    <input type="file" accept="image/*" id="cameraInput" capture="environment" style="display:none;" onchange="handleFileSelect(event)">
    <button onclick="document.getElementById('cameraInput').click();">Take Photo</button>
    
    <!-- Timer UI -->
    <h1 id="timer">00:00:00</h1>
    <button onclick="startStopwatch()">Start Timer</button>
    <button onclick="stopStopwatch()">Stop Timer</button>

    <script>
        let stopwatchInterval;
        let startTime;
        
        // Google Sign-In: Handle successful sign-in
        function onSignIn(googleUser) {
            const authResponse = googleUser.getAuthResponse();
            const accessToken = authResponse.access_token;
            gapi.auth.setToken({ access_token: accessToken });
            console.log('User signed in with token:', accessToken);
        }

        // Function to start the timer
        function startStopwatch() {
            startTime = Date.now();
            stopwatchInterval = setInterval(updateStopwatch, 100);
        }

        // Function to stop the timer
        function stopStopwatch() {
            clearInterval(stopwatchInterval);
        }

        // Function to update the stopwatch display
        function updateStopwatch() {
            const currentTime = Date.now();
            const elapsedTime = currentTime - startTime;
            const seconds = Math.floor((elapsedTime / 1000) % 60);
            const minutes = Math.floor((elapsedTime / (1000 * 60)) % 60);
            const hours = Math.floor((elapsedTime / (1000 * 60 * 60)) % 24);

            document.getElementById('timer').innerText = 
                String(hours).padStart(2, '0') + ':' + 
                String(minutes).padStart(2, '0') + ':' + 
                String(seconds).padStart(2, '0');
        }

        // Function to handle file selection and upload to Google Photos
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                uploadToGooglePhotos(file);
            }
        }

        // Function to upload the file to Google Photos
        function uploadToGooglePhotos(file) {
            const uploadUrl = 'https://photoslibrary.googleapis.com/v1/uploads';

            fetch(uploadUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${gapi.auth.getToken().access_token}`,
                    'Content-Type': 'application/octet-stream',
                    'X-Goog-Upload-File-Name': file.name,
                    'X-Goog-Upload-Protocol': 'raw',
                },
                body: file,
            })
            .then(response => response.text())
            .then(uploadToken => {
                console.log('Upload token:', uploadToken);
                // Now that we have the uploadToken, add it to the user's library
                addToLibrary(uploadToken);
            })
            .catch(error => console.error('Upload failed', error));
        }

        // Function to add the uploaded file to the user's Google Photos library
        function addToLibrary(uploadToken) {
            const addPhotoUrl = 'https://photoslibrary.googleapis.com/v1/mediaItems:batchCreate';
            const requestBody = {
                newMediaItems: [
                    {
                        simpleMediaItem: {
                            uploadToken: uploadToken,
                        },
                    },
                ],
            };

            fetch(addPhotoUrl, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${gapi.auth.getToken().access_token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Added to library:', data);
            })
            .catch(error => console.error('Error adding to library', error));
        }

    </script>
</body>
</html>
