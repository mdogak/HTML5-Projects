<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stopwatch with Split Times and Presets</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .time-display {
            font-size: 3em;
            margin-bottom: 20px;
        }
        button {
            font-size: 1.2em;
            padding: 10px 15px;
            margin: 10px;
        }
        .split-row {
            margin: 20px 0;
        }
        .split-result, .projected, .mile-pace {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input {
            padding: 5px;
            font-size: 1.1em;
            width: 80px;
        }
        .preset-buttons {
            margin-top: 20px;
        }
        label {
            margin-right: 10px;
        }
        @media only screen and (max-width: 600px) {
            .time-display {
                font-size: 2em;
            }
            input {
                width: 60px;
            }
            button {
                font-size: 1em;
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>

    <div style="margin-top: 30px;">
        <div class="preset-buttons">
            <button onclick="setPreset('800M')">800M</button>
            <button onclick="setPreset('1600M')">1600M</button>
            <button onclick="setPreset('3200M')">3200M</button>
            <button onclick="setPreset('5k')">5K</button>
        </div>
        <div style="margin-top: 20px;">
            <label for="race-length">Race Length: </label>
            <input type="number" id="race-length" placeholder="<Enter>">
        </div>
    </div>

    <div style="margin-top: 30px;">
        <div class="time-display" id="display">00:00:00.00</div>
        <button id="startStopBtn" onclick="toggleStopwatch()">Start</button>
        <button onclick="clearStopwatch()">Clear</button>
    </div>
	
    <div style="margin-top: 30px;" id="split-container">
        <div id="split-rows"></div>
    </div>

    <script>
        let timer;
        let elapsedTime = 0; // In milliseconds
        let running = false;

        function setCookie(name, value, days) {
            const expires = new Date(Date.now() + days * 864e5).toUTCString();
            document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/';
        }

        function getCookie(name) {
            return document.cookie.split('; ').reduce((r, v) => {
                const parts = v.split('=');
                return parts[0] === name ? decodeURIComponent(parts[1]) : r;
            }, '');
        }

        function deleteCookie(name) {
            setCookie(name, '', -1);
        }

        function formatTime(ms) {
            const totalSeconds = ms / 1000;
            const hrs = Math.floor(totalSeconds / 3600);
            const mins = Math.floor((totalSeconds % 3600) / 60);
            const secs = (totalSeconds % 60).toFixed(1); // Shows seconds with one decimal place

            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(5, '0')}`;
        }

        function toggleStopwatch() {
            if (running) {
                stopStopwatch();
            } else {
                startStopwatch();
            }
        }

        function startStopwatch() {
            if (!timer) {
                const currentTime = Date.now();
                const startTime = currentTime - elapsedTime;
                timer = setInterval(() => {
                    elapsedTime = Date.now() - startTime;
                    document.getElementById('display').textContent = formatTime(elapsedTime);
                    setCookie('elapsedTime', elapsedTime, 1);
                }, 10); // Updates every 10 milliseconds
                running = true;
                setCookie('running', true, 1);
                document.getElementById('startStopBtn').textContent = 'Stop';
            }
        }

        function stopStopwatch() {
            clearInterval(timer);
            timer = null;
            running = false;
            setCookie('running', false, 1);
            document.getElementById('startStopBtn').textContent = 'Start';
        }

        function clearStopwatch() {
            stopStopwatch();
            elapsedTime = 0;
            document.getElementById('display').textContent = '00:00:00.00';
            clearSplits();
            deleteCookie('elapsedTime');
            deleteCookie('running');
        }

        function clearSplits() {
            for (let i = 1; i <= 9; i++) {
                document.getElementById('split-time-' + i).textContent = '';
                document.getElementById('mile-pace-' + i).textContent = '';
                document.getElementById('projected-time-' + i).textContent = '';
                if (document.getElementById('split-' + i)) {
                    document.getElementById('split-' + i).value = '';
                }
            }
            deleteCookie('splitTimes');
        }

        function recordSplit(index) {
            const raceLength = parseFloat(document.getElementById('race-length').value);
            const splitDistance = parseFloat(document.getElementById('split-' + index).value);

            if (!raceLength || !splitDistance) {
                alert('Please enter both race length and split distance.');
                return;
            }

            // Get current time for split
            const currentSplitTime = elapsedTime;
            const splitTimeFormatted = formatTime(currentSplitTime);
            document.getElementById('split-time-' + index).textContent = `Time from Start: ${splitTimeFormatted}`;

            // Calculate mile pace
            const milePace = (currentSplitTime * 1600) / splitDistance;
            const milePaceFormatted = formatTime(milePace);
            document.getElementById('mile-pace-' + index).textContent = `Mile Pace: ${milePaceFormatted}`;

            // Calculate projected finish time
            const projectedFinishTime = (currentSplitTime * raceLength) / splitDistance;
            const projectedFinishFormatted = formatTime(projectedFinishTime);
            document.getElementById('projected-time-' + index).textContent = `Projected Finish: ${projectedFinishFormatted}`;

            // Save splits in cookies
            const splitTimes = getCookie('splitTimes') ? JSON.parse(getCookie('splitTimes')) : {};
            splitTimes[index] = { time: splitTimeFormatted, pace: milePaceFormatted, projected: projectedFinishFormatted };
            setCookie('splitTimes', JSON.stringify(splitTimes), 1);
        }

        function setPreset(preset) {
            const distances = {
                '800M': [200, 400],
                '1600M': [200, 600, 1000, 1400, 1600],
                '3200M': [200, 600, 1000, 1400, 1800, 2200, 2600, 3000, 3200],
                '5K': [1000, 2000, 3000, 4000, 5000]
            };

            if (distances[preset]) {
                const distanceValues = distances[preset];
                document.getElementById('race-length').value = distanceValues[distanceValues.length - 1]; // Set race length to last distance
                for (let i = 0; i < distanceValues.length; i++) {
                    if (i < 9) {
                        const splitRow = document.createElement('div');
                        splitRow.className = 'split-row';
                        splitRow.innerHTML = `
                            <label>Distance ${i + 1}: </label>
                            <input type="number" id="split-${i + 1}" placeholder="<Enter>" value="${distanceValues[i]}">
                            <button onclick="recordSplit(${i + 1})">Split</button>
                            <span class="split-result" id="split-time-${i + 1}"></span>
                            <span class="mile-pace" id="mile-pace-${i + 1}"></span>
                            <span class="projected" id="projected-time-${i + 1}"></span>
                        `;
                        document.getElementById('split-rows').appendChild(splitRow);
                    }
                }
                setCookie('presetDistances', JSON.stringify(distanceValues), 1);
            }
        }

        function loadPresets() {
            const presetDistances = JSON.parse(getCookie('presetDistances'));
            if (presetDistances) {
                presetDistances.forEach((distance, index) => {
                    document.getElementById('split-' + (index + 1)).value = distance;
                });
            }
            const raceLength = getCookie('raceLength');
            if (raceLength) {
                document.getElementById('race-length').value = raceLength;
            }
        }

        function loadStopwatch() {
            const savedElapsedTime = getCookie('elapsedTime');
            const savedRunning = getCookie('running');
            if (savedElapsedTime) {
                elapsedTime = parseInt(savedElapsedTime, 10);
                document.getElementById('display').textContent = formatTime(elapsedTime);
            }
            if (savedRunning === 'true') {
                startStopwatch();
            }
            const splitTimes = JSON.parse(getCookie('splitTimes'));
            if (splitTimes) {
                for (let index in splitTimes) {
                    document.getElementById('split-time-' + index).textContent = `Time from Start: ${splitTimes[index].time}`;
                    document.getElementById('mile-pace-' + index).textContent = `Mile Pace: ${splitTimes[index].pace}`;
                    document.getElementById('projected-time-' + index).textContent = `Projected Finish: ${splitTimes[index].projected}`;
                }
            }
        }

        window.onload = function() {
            loadPresets();
            loadStopwatch();
        };
    </script>
</body>
</html>
